<div class="log-page">
  <div class="log-card" role="region" aria-label="Historial de cargas">
    <header class="log-card-header">
      <div class="header-left">
        <div class="header-icon" aria-hidden="true">
          <!-- clipboard SVG -->
          <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect x="8" y="2" width="8" height="4" rx="1" fill="currentColor" opacity="0.12"></rect>
            <path d="M7 6h10a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1z" stroke="currentColor" stroke-width="1.2" fill="none"/>
          </svg>
        </div>
        <div class="header-text">
          <h1>Historial de Cargas</h1>
          <p class="muted">Registros recientes de cargas de archivos y su estado</p>
        </div>
      </div>

      <div class="header-actions">
        <button class="btn btn-ghost" (click)="goBack()" type="button" title="Volver a carga">← Volver</button>
      </div>
    </header>

    <section class="log-summary">
      <div class="summary-item">
        <div class="label">Usuario</div>
        <div class="value">{{ currentUsername || '-' }}</div>
      </div>
      <div class="summary-item">
        <div class="label">Total de cargas</div>
        <div class="value">{{ totalUploads }}</div>
      </div>
    </section>

    <div *ngIf="loading" class="loading">
      <div class="spinner" aria-hidden="true"></div>
      <div class="loading-text">Cargando historial...</div>
    </div>

    <div *ngIf="errorMessage && !loading" class="alert alert-danger">
      <p>{{ errorMessage }}</p>
      <button class="btn btn-primary" (click)="retry()" type="button">Reintentar</button>
    </div>

    <div *ngIf="!loading && logs.length > 0" class="table-wrapper">
      <table class="log-table" role="table" aria-label="Tabla historial de cargas">
        <thead>
          <tr>
            <th>ID</th>
            <th>Archivo</th>
            <th>Fecha</th>
            <th>Hora</th>
            <th>Estado</th>
            <th>Registros</th>
            <th>Errores</th>
            <th>Mensaje</th>
            <th>Acciones</th> <!-- Nueva columna para acciones -->
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let log of logs" [class]="getStatusClass(log.status) + ' log-row'">
            <td class="cell-id">{{ log.id }}</td>
            <td class="cell-file">
              <span class="file-icon" aria-hidden="true">
                <!-- small file SVG -->
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" stroke="currentColor" stroke-width="1.2" fill="none"/>
                  <path d="M14 2v6h6" stroke="currentColor" stroke-width="1.2" fill="none"/>
                </svg>
              </span>
              <span class="file-name">{{ log.filename }}</span>
            </td>
            <td class="cell-date">{{ log.uploadDate }}</td>
            <td class="cell-time">{{ log.uploadTime }}</td>
            <td class="cell-status">
              <span class="status-badge" [ngClass]="getStatusClass(log.status)">
                <span class="status-icon">{{ getStatusIcon(log.status) }}</span>
                <span class="status-text">{{ getStatusText(log.status) }}</span>
              </span>
            </td>
            <td class="cell-processed"><span class="count">{{ log.recordsProcessed }}</span></td>
            <td class="cell-errors"><span class="count error" [title]="log.recordsError > 0 ? 'Errores detectados' : '0'">{{ log.recordsError }}</span></td>
            <td class="cell-message">
              <span *ngIf="log.errorMessage" class="message" title="{{ log.errorMessage }}">{{ log.errorMessage }}</span>
              <span *ngIf="!log.errorMessage" class="muted">-</span>
            </td>
            <td class="cell-actions">
              <!-- Botón de descarga -->
              <button class="btn btn-primary btn-sm" (click)="downloadFile(log.uploadId)" title="Descargar archivo">
                <!-- download SVG icon -->
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M5 20h14M12 3v18M19 13l-7 7-7-7" stroke="currentColor" stroke-width="1.5" fill="none"/>
                </svg>
                Descargar
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div *ngIf="!loading && logs.length === 0" class="empty">
      <p>No hay registros de carga disponibles.</p>
    </div>
  </div>
</div>
