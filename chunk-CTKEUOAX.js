import{b as te,c as ne,f as oe,h as ie,i as re,j as ae,l as le}from"./chunk-FP3ORZCT.js";import{A as w,D as h,F as c,G as W,H as q,I as K,J as t,K as n,L as p,M,N as x,O as f,P as J,Q,R as r,S as g,T as k,U as j,V as N,W as R,Y as S,Z as V,_ as X,a as $,aa as Y,c as U,ga as E,ha as L,ia as I,k as z,ka as Z,la as T,m as y,na as P,oa as D,qa as A,r as C,s as b,t as u,ta as ee,u as v,xa as O,ya as B,z as a}from"./chunk-ANQ2OVV2.js";var he=(o,d)=>({"alert-success":o,"alert-error":d});function fe(o,d){o&1&&(t(0,"div",22)(1,"strong"),r(2,"Arrastra y suelta el archivo aqu\xED"),n(),t(3,"span"),r(4,"o haz clic para seleccionar un archivo .xlsx o .xls"),n(),t(5,"span",23),r(6,"Tama\xF1o m\xE1ximo: 10 MB"),n()())}function _e(o,d){if(o&1){let e=M();t(0,"div",24),u(),t(1,"svg",25),p(2,"path",26)(3,"path",27),n(),v(),t(4,"div",28)(5,"div",29),r(6),n(),t(7,"div",30),r(8),n()(),t(9,"button",31),x("click",function(i){return C(e),f().removeSelected(),b(i.stopPropagation())}),u(),t(10,"svg",32),p(11,"path",33),n()()()}if(o&2){let e=f();a(6),g(e.selectedFile.name),a(2),g(e.formatBytes(e.selectedFile.size))}}function xe(o,d){if(o&1&&(t(0,"div",34)(1,"div",35),p(2,"div",36),n(),t(3,"div",37),r(4),n()()),o&2){let e=f();a(2),W("width",e.progress,"%"),a(2),k("Subiendo... ",e.progress,"%")}}function Ce(o,d){o&1&&(t(0,"span"),r(1,"Subir Archivo"),n())}function be(o,d){o&1&&(t(0,"span"),r(1,"Subiendo..."),n())}function ve(o,d){if(o&1){let e=M();t(0,"button",38),x("click",function(){C(e);let i=f();return b(i.reset())}),r(1," Limpiar "),n()}if(o&2){let e=f();c("disabled",e.uploading)}}function Me(o,d){o&1&&(u(),p(0,"circle",45))}function Pe(o,d){o&1&&(u(),p(0,"path",46))}function Oe(o,d){o&1&&(u(),p(0,"circle",47))}function ye(o,d){o&1&&(u(),p(0,"path",48))}function we(o,d){o&1&&(u(),p(0,"circle",45))}function ke(o,d){if(o&1&&(t(0,"div",39),u(),t(1,"svg",40),h(2,Me,1,0,"circle",41)(3,Pe,1,0,"path",42)(4,Oe,1,0,"circle",43)(5,ye,1,0,"path",44)(6,we,1,0,"circle",41),n(),v(),t(7,"span"),r(8),n()()),o&2){let e=f();c("ngClass",V(7,he,e.messageType==="success",e.messageType==="error")),a(2),c("ngIf",e.messageType==="error"),a(),c("ngIf",e.messageType==="error"),a(),c("ngIf",e.messageType==="error"),a(),c("ngIf",e.messageType==="success"),a(),c("ngIf",e.messageType==="success"),a(2),g(e.message)}}var de=(()=>{class o{constructor(e){this.http=e,this.message="",this.messageType="",this.uploading=!1,this.progress=0,this.isDragOver=!1,this.uploadUrl=`${O.apiUrl}/retiros/disponibilidad/cargar`,this.authService=z(B)}onFileSelected(e){let s=e.target?.files?.[0];this.handleFile(s)}onDragOver(e){e.preventDefault(),this.isDragOver=!0}onDragLeave(e){e.preventDefault(),this.isDragOver=!1}onDrop(e){e.preventDefault(),this.isDragOver=!1;let s=e.dataTransfer?.files?.[0];this.handleFile(s)}handleFile(e){if(!e){this.selectedFile=void 0,this.message="";return}let s=10*1024*1024;if(e.size>s){this.selectedFile=void 0,this.message="El archivo excede el tama\xF1o m\xE1ximo permitido (10 MB).",this.messageType="error";return}let i=e.name.split(".").pop()?.toLowerCase();if(!i||!["xlsx","xls"].includes(i)){this.selectedFile=void 0,this.message="Formato no v\xE1lido. Selecciona un archivo .xlsx o .xls",this.messageType="error";return}this.selectedFile=e,this.message=`Archivo seleccionado: ${e.name}`,this.messageType="",this.progress=0}removeSelected(){this.selectedFile=void 0,this.message="",this.progress=0}reset(){this.removeSelected(),this.messageType="",this.message="",this.uploading=!1}convertFileToBase64(e){return U(this,null,function*(){return new Promise((s,i)=>{let l=new FileReader;l.readAsDataURL(e),l.onload=()=>{let _=l.result.split(",")[1];s(_)},l.onerror=m=>i(m)})})}uploadFile(){return U(this,null,function*(){if(!(!this.selectedFile||this.uploading)){this.uploading=!0,this.progress=33,this.message="Preparando archivo...",this.messageType="";try{console.log("Subiendo archivo:",this.selectedFile.name,"Tama\xF1o:",this.selectedFile.size,"bytes"),console.log("URL de destino:",this.uploadUrl),this.message="Convirtiendo archivo...",this.progress=50;let e=yield this.convertFileToBase64(this.selectedFile);console.log("Archivo convertido a base64, longitud:",e.length);let s={filename:this.selectedFile.name,content:e,content_type:this.selectedFile.type||"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"},i=this.authService.getToken(),l=new P($({"Content-Type":"application/json"},i?{Authorization:`Bearer ${i}`}:{}));this.message="Enviando archivo...",this.progress=75,this.http.post(this.uploadUrl,s,{headers:l}).subscribe({next:m=>{console.log("Respuesta exitosa:",m),this.uploading=!1,this.progress=100,this.message="Archivo cargado con \xE9xito",this.messageType="success",setTimeout(()=>this.removeSelected(),1200)},error:m=>{console.error("Error al subir archivo:",m),this.uploading=!1,this.progress=0,this.messageType="error";let _=m?.error?.detail||m?.message||"Error desconocido";this.message=`Error al subir archivo: ${_}`}})}catch(e){console.error("Error al procesar archivo:",e),this.uploading=!1,this.progress=0,this.messageType="error",this.message="Error al procesar el archivo"}}})}formatBytes(e){if(e===0)return"0 B";let s=1024,i=["B","KB","MB","GB"],l=Math.floor(Math.log(e)/Math.log(s));return parseFloat((e/Math.pow(s,l)).toFixed(2))+" "+i[l]}static{this.\u0275fac=function(s){return new(s||o)(w(D))}}static{this.\u0275cmp=y({type:o,selectors:[["app-carga-excel"]],standalone:!0,features:[S],decls:28,vars:10,consts:[["fileInput",""],[1,"carga-excel-container"],[1,"page-header"],[1,"subtitle"],[1,"upload-section"],[1,"upload-card"],["tabindex","0","role","button","aria-label","\xC1rea de arrastrar y soltar archivo",1,"dropzone",3,"dragover","dragleave","drop"],["type","file","accept",".xlsx,.xls","hidden","",3,"change"],[1,"drop-content",3,"click"],["viewBox","0 0 64 64","aria-hidden","true",1,"upload-icon"],["cx","32","cy","32","r","30","fill","none","stroke","currentColor","stroke-width","2","opacity","0.1"],["d","M32 20v20","stroke","currentColor","stroke-width","3","stroke-linecap","round"],["d","M24 28l8-8 8 8","stroke","currentColor","stroke-width","3","stroke-linecap","round","stroke-linejoin","round"],["d","M20 44h24","stroke","currentColor","stroke-width","3","stroke-linecap","round"],["class","drop-text",4,"ngIf"],["class","file-selected",4,"ngIf"],["class","progress-section",4,"ngIf"],[1,"button-group"],[1,"btn","btn-primary",3,"click","disabled"],[4,"ngIf"],["class","btn btn-secondary",3,"disabled","click",4,"ngIf"],["class","alert",3,"ngClass",4,"ngIf"],[1,"drop-text"],[1,"file-limit"],[1,"file-selected"],["viewBox","0 0 24 24","aria-hidden","true",1,"file-icon"],["d","M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z","stroke","currentColor","stroke-width","1.5","fill","none"],["d","M14 2v6h6","stroke","currentColor","stroke-width","1.5","fill","none"],[1,"file-details"],[1,"file-name"],[1,"file-size"],["type","button","title","Eliminar archivo",1,"btn-remove",3,"click"],["width","20","height","20","viewBox","0 0 24 24","fill","none"],["d","M18 6L6 18M6 6l12 12","stroke","currentColor","stroke-width","2","stroke-linecap","round"],[1,"progress-section"],[1,"progress-bar-container"],[1,"progress-bar"],[1,"progress-text"],[1,"btn","btn-secondary",3,"click","disabled"],[1,"alert",3,"ngClass"],["width","20","height","20","viewBox","0 0 24 24","fill","none","xmlns","http://www.w3.org/2000/svg"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","2",4,"ngIf"],["d","M12 8v4","stroke","currentColor","stroke-width","2","stroke-linecap","round",4,"ngIf"],["cx","12","cy","16","r","1","fill","currentColor",4,"ngIf"],["d","M9 12l2 2 4-4","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",4,"ngIf"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","2"],["d","M12 8v4","stroke","currentColor","stroke-width","2","stroke-linecap","round"],["cx","12","cy","16","r","1","fill","currentColor"],["d","M9 12l2 2 4-4","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"]],template:function(s,i){if(s&1){let l=M();t(0,"div",1)(1,"div",2)(2,"h1"),r(3,"Carga de Archivo Excel"),n(),t(4,"p",3),r(5,"Sube un archivo .xlsx para cargar la disponibilidad de retiros"),n()(),t(6,"div",4)(7,"div",5)(8,"h2"),r(9,"Seleccionar Archivo"),n(),t(10,"div",6),x("dragover",function(_){return C(l),b(i.onDragOver(_))})("dragleave",function(_){return C(l),b(i.onDragLeave(_))})("drop",function(_){return C(l),b(i.onDrop(_))}),t(11,"input",7,0),x("change",function(_){return C(l),b(i.onFileSelected(_))}),n(),t(13,"div",8),x("click",function(){C(l);let _=Q(12);return b(_.click())}),u(),t(14,"svg",9),p(15,"circle",10)(16,"path",11)(17,"path",12)(18,"path",13),n(),h(19,fe,7,0,"div",14)(20,_e,12,2,"div",15),n()(),h(21,xe,5,3,"div",16),v(),t(22,"div",17)(23,"button",18),x("click",function(){return C(l),b(i.uploadFile())}),h(24,Ce,2,0,"span",19)(25,be,2,0,"span",19),n(),h(26,ve,2,1,"button",20),n(),h(27,ke,9,10,"div",21),n()()()}s&2&&(a(10),q("dragover",i.isDragOver),a(9),c("ngIf",!i.selectedFile),a(),c("ngIf",i.selectedFile),a(),c("ngIf",i.uploading),a(2),c("disabled",!i.selectedFile||i.uploading),a(),c("ngIf",!i.uploading),a(),c("ngIf",i.uploading),a(),c("ngIf",i.selectedFile||i.message),a(),c("ngIf",i.message))},dependencies:[T,E,I,A],styles:[".carga-excel-container[_ngcontent-%COMP%]{padding:2rem;max-width:1400px;margin:0 auto}.page-header[_ngcontent-%COMP%]{margin-bottom:2rem}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:2rem;font-weight:600;color:#1a1a1a;margin:0 0 .5rem}.page-header[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{color:#666;font-size:1rem;margin:0}.upload-section[_ngcontent-%COMP%]{margin-bottom:2rem}.upload-card[_ngcontent-%COMP%]{background:#fff;border-radius:8px;padding:2rem;box-shadow:0 2px 8px #0000001a}.upload-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600;color:#1a1a1a;margin:0 0 1.5rem}.dropzone[_ngcontent-%COMP%]{border:2px dashed #ddd;border-radius:8px;padding:3rem 2rem;text-align:center;cursor:pointer;transition:all .2s;background-color:#fafafa}.dropzone[_ngcontent-%COMP%]:hover{border-color:#4a90e2;background-color:#f5f9ff}.dropzone.dragover[_ngcontent-%COMP%]{border-color:#4a90e2;background-color:#e3f2fd;transform:scale(1.02)}.dropzone[_ngcontent-%COMP%]:focus{outline:none;border-color:#4a90e2;box-shadow:0 0 0 3px #4a90e21a}.drop-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:1rem}.upload-icon[_ngcontent-%COMP%]{width:80px;height:80px;color:#4a90e2;margin-bottom:.5rem}.drop-text[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.drop-text[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-size:1.125rem;color:#1a1a1a;font-weight:600}.drop-text[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#666;font-size:.95rem}.drop-text[_ngcontent-%COMP%]   .file-limit[_ngcontent-%COMP%]{color:#999;font-size:.875rem;margin-top:.25rem}.file-selected[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;padding:1rem;background-color:#fff;border-radius:8px;border:1px solid #e9ecef;width:100%;max-width:500px}.file-icon[_ngcontent-%COMP%]{width:40px;height:40px;color:#4a90e2;flex-shrink:0}.file-details[_ngcontent-%COMP%]{flex:1;text-align:left;min-width:0}.file-name[_ngcontent-%COMP%]{font-weight:600;color:#1a1a1a;font-size:1rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-bottom:.25rem}.file-size[_ngcontent-%COMP%]{color:#666;font-size:.875rem}.btn-remove[_ngcontent-%COMP%]{width:36px;height:36px;display:flex;align-items:center;justify-content:center;border:none;border-radius:6px;background-color:#fee;color:#c00;cursor:pointer;transition:all .2s;flex-shrink:0}.btn-remove[_ngcontent-%COMP%]:hover{background-color:#fcc}.progress-section[_ngcontent-%COMP%]{margin:1.5rem 0}.progress-bar-container[_ngcontent-%COMP%]{width:100%;height:8px;background-color:#e9ecef;border-radius:4px;overflow:hidden;margin-bottom:.5rem}.progress-bar[_ngcontent-%COMP%]{height:100%;background:linear-gradient(90deg,#4a90e2,#2a6bae);transition:width .3s ease;border-radius:4px}.progress-text[_ngcontent-%COMP%]{text-align:center;color:#666;font-size:.95rem;font-weight:500}.button-group[_ngcontent-%COMP%]{display:flex;gap:1rem;margin-top:1.5rem}.btn[_ngcontent-%COMP%]{padding:.75rem 1.5rem;border:none;border-radius:6px;font-size:1rem;font-weight:500;cursor:pointer;transition:all .2s}.btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.btn-primary[_ngcontent-%COMP%]{background-color:#4a90e2;color:#fff}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#3a7bc8}.btn-primary[_ngcontent-%COMP%]:active:not(:disabled){background-color:#2a6bae}.btn-secondary[_ngcontent-%COMP%]{background-color:#f5f5f5;color:#333}.btn-secondary[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#e5e5e5}.alert[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;padding:1rem;border-radius:6px;margin-top:1rem}.alert[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{flex-shrink:0}.alert-error[_ngcontent-%COMP%]{background-color:#fee;color:#c00;border:1px solid #fcc}.alert-success[_ngcontent-%COMP%]{background-color:#d4edda;color:#155724;border:1px solid #c3e6cb}@media (max-width: 768px){.carga-excel-container[_ngcontent-%COMP%]{padding:1rem}.upload-card[_ngcontent-%COMP%]{padding:1.5rem}.dropzone[_ngcontent-%COMP%]{padding:2rem 1rem}.upload-icon[_ngcontent-%COMP%]{width:60px;height:60px}.button-group[_ngcontent-%COMP%]{flex-direction:column}.button-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{width:100%}.file-selected[_ngcontent-%COMP%]{max-width:100%}}"]})}}return o})();function Se(o,d){o&1&&(t(0,"div",20),p(1,"div",21),t(2,"div",22),r(3,"Cargando historial..."),n()())}function Ee(o,d){if(o&1){let e=M();t(0,"div",23)(1,"p"),r(2),n(),t(3,"button",24),x("click",function(){C(e);let i=f();return b(i.retry())}),r(4,"Reintentar"),n()()}if(o&2){let e=f();a(2),g(e.errorMessage)}}function Ie(o,d){if(o&1&&(t(0,"span",52),r(1),n()),o&2){let e=f().$implicit;J("title",e.errorMessage),a(),g(e.errorMessage)}}function Te(o,d){o&1&&(t(0,"span",9),r(1,"-"),n())}function De(o,d){if(o&1){let e=M();t(0,"tr")(1,"td",28),r(2),n(),t(3,"td",29)(4,"span",30),u(),t(5,"svg",31),p(6,"path",32)(7,"path",33),n()(),v(),t(8,"span",34),r(9),n()(),t(10,"td",35),r(11),n(),t(12,"td",36),r(13),n(),t(14,"td",37)(15,"span",38)(16,"span",39),r(17),n(),t(18,"span",40),r(19),n()()(),t(20,"td",41)(21,"span",42),r(22),n()(),t(23,"td",43)(24,"span",44),r(25),n()(),t(26,"td",45),h(27,Ie,2,2,"span",46)(28,Te,2,0,"span",47),n(),t(29,"td",48)(30,"button",49),x("click",function(){let i=C(e).$implicit,l=f(2);return b(l.downloadFile(i.uploadId))}),u(),t(31,"svg",50),p(32,"path",51),n(),r(33," Descargar "),n()()()}if(o&2){let e=d.$implicit,s=f(2);K(s.getStatusClass(e.status)+" log-row"),a(2),g(e.id),a(7),g(e.filename),a(2),g(e.uploadDate),a(2),g(e.uploadTime),a(2),c("ngClass",s.getStatusClass(e.status)),a(2),g(s.getStatusIcon(e.status)),a(2),g(s.getStatusText(e.status)),a(3),g(e.recordsProcessed),a(2),c("title",e.recordsError>0?"Errores detectados":"0"),a(),g(e.recordsError),a(2),c("ngIf",e.errorMessage),a(),c("ngIf",!e.errorMessage)}}function Fe(o,d){if(o&1&&(t(0,"div",25)(1,"table",26)(2,"thead")(3,"tr")(4,"th"),r(5,"ID"),n(),t(6,"th"),r(7,"Archivo"),n(),t(8,"th"),r(9,"Fecha"),n(),t(10,"th"),r(11,"Hora"),n(),t(12,"th"),r(13,"Estado"),n(),t(14,"th"),r(15,"Registros"),n(),t(16,"th"),r(17,"Errores"),n(),t(18,"th"),r(19,"Mensaje"),n(),t(20,"th"),r(21,"Acciones"),n()()(),t(22,"tbody"),h(23,De,34,14,"tr",27),n()()()),o&2){let e=f();a(23),c("ngForOf",e.logs)}}function ze(o,d){o&1&&(t(0,"div",53)(1,"p"),r(2,"No hay registros de carga disponibles."),n()())}var me=(()=>{class o{constructor(e){this.router=e,this.logs=[],this.loading=!0,this.errorMessage=null,this.currentUsername=null,this.totalUploads=0,this.historialUrl=`${O.apiUrl}/retiros/disponibilidad/historial`,this.authService=z(B),this.http=z(D)}ngOnInit(){this.currentUsername=this.authService.getUsername(),this.loadLogs()}loadLogs(){this.loading=!0,this.errorMessage=null;let e=this.authService.getToken(),s=e?new P({Authorization:`Bearer ${e}`}):void 0;console.log("Cargando historial desde:",this.historialUrl),this.http.get(this.historialUrl,{headers:s}).subscribe({next:i=>{console.log("Historial recibido:",i),i.ok&&i.historial?(this.totalUploads=i.total_uploads,this.currentUsername=i.username,this.logs=i.historial.map(l=>({id:l.id,uploadId:l.upload_id,filename:l.filename,uploadDate:l.upload_date,uploadTime:l.upload_time,status:this.normalizeStatus(l.status),recordsProcessed:l.successful_records,recordsError:l.failed_records,errorMessage:l.error_message||void 0,processingTime:l.processing_time}))):(this.logs=[],this.totalUploads=0),this.loading=!1},error:i=>{console.error("Error al cargar historial:",i),this.loading=!1,this.errorMessage="Error al cargar el historial de cargas. Por favor, intente nuevamente.",this.logs=[],this.totalUploads=0}})}normalizeStatus(e){let s=e.toLowerCase();return s==="exitoso"||s==="success"?"exitoso":s==="error"||s==="failed"?"error":"pendiente"}getStatusClass(e){return{exitoso:"status-success",error:"status-error",pendiente:"status-pending"}[e]||"status-pending"}getStatusText(e){return{exitoso:"\u2713 Exitoso",error:"\u2717 Error",pendiente:"\u23F3 Pendiente"}[e]||e}getStatusIcon(e){return{exitoso:"\u2713",error:"\u2717",pendiente:"\u23F3"}[e]||"?"}retry(){this.loadLogs()}goBack(){this.router.navigate(["/retiros/carga-excel"])}downloadFile(e){let s=this.authService.getToken(),i=s?new P({Authorization:`Bearer ${s}`}):void 0;this.http.get(`${O.apiUrl}/retiros/descargar/excel/${e}`,{headers:i,responseType:"text"}).subscribe({next:l=>{try{let m=atob(l),_=new Uint8Array(m.length);for(let H=0;H<m.length;H++)_[H]=m.charCodeAt(H);let pe=new Blob([_],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),G=window.URL.createObjectURL(pe),F=document.createElement("a");F.href=G,F.download=`disponibilidad_${e}.xlsx`,document.body.appendChild(F),F.click(),document.body.removeChild(F),window.URL.revokeObjectURL(G)}catch(m){console.error("Error al decodificar el archivo:",m),alert("Error al procesar el archivo descargado.")}},error:l=>{console.error("Error al descargar el archivo:",l),alert("Error al descargar el archivo. Por favor, intente nuevamente.")}})}static{this.\u0275fac=function(s){return new(s||o)(w(ee))}}static{this.\u0275cmp=y({type:o,selectors:[["app-log"]],standalone:!0,features:[S],decls:31,vars:6,consts:[[1,"log-page"],["role","region","aria-label","Historial de cargas",1,"log-card"],[1,"log-card-header"],[1,"header-left"],["aria-hidden","true",1,"header-icon"],["width","28","height","28","viewBox","0 0 24 24","fill","none","xmlns","http://www.w3.org/2000/svg"],["x","8","y","2","width","8","height","4","rx","1","fill","currentColor","opacity","0.12"],["d","M7 6h10a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1z","stroke","currentColor","stroke-width","1.2","fill","none"],[1,"header-text"],[1,"muted"],[1,"header-actions"],["type","button","title","Volver a carga",1,"btn","btn-ghost",3,"click"],[1,"log-summary"],[1,"summary-item"],[1,"label"],[1,"value"],["class","loading",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],["class","table-wrapper",4,"ngIf"],["class","empty",4,"ngIf"],[1,"loading"],["aria-hidden","true",1,"spinner"],[1,"loading-text"],[1,"alert","alert-danger"],["type","button",1,"btn","btn-primary",3,"click"],[1,"table-wrapper"],["role","table","aria-label","Tabla historial de cargas",1,"log-table"],[3,"class",4,"ngFor","ngForOf"],[1,"cell-id"],[1,"cell-file"],["aria-hidden","true",1,"file-icon"],["width","18","height","18","viewBox","0 0 24 24","fill","none","xmlns","http://www.w3.org/2000/svg"],["d","M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z","stroke","currentColor","stroke-width","1.2","fill","none"],["d","M14 2v6h6","stroke","currentColor","stroke-width","1.2","fill","none"],[1,"file-name"],[1,"cell-date"],[1,"cell-time"],[1,"cell-status"],[1,"status-badge",3,"ngClass"],[1,"status-icon"],[1,"status-text"],[1,"cell-processed"],[1,"count"],[1,"cell-errors"],[1,"count","error",3,"title"],[1,"cell-message"],["class","message",3,"title",4,"ngIf"],["class","muted",4,"ngIf"],[1,"cell-actions"],["title","Descargar archivo",1,"btn","btn-primary","btn-sm",3,"click"],["width","16","height","16","viewBox","0 0 24 24","fill","none","xmlns","http://www.w3.org/2000/svg"],["d","M5 20h14M12 3v18M19 13l-7 7-7-7","stroke","currentColor","stroke-width","1.5","fill","none"],[1,"message",3,"title"],[1,"empty"]],template:function(s,i){s&1&&(t(0,"div",0)(1,"div",1)(2,"header",2)(3,"div",3)(4,"div",4),u(),t(5,"svg",5),p(6,"rect",6)(7,"path",7),n()(),v(),t(8,"div",8)(9,"h1"),r(10,"Historial de Cargas"),n(),t(11,"p",9),r(12,"Registros recientes de cargas de archivos y su estado"),n()()(),t(13,"div",10)(14,"button",11),x("click",function(){return i.goBack()}),r(15,"\u2190 Volver"),n()()(),t(16,"section",12)(17,"div",13)(18,"div",14),r(19,"Usuario"),n(),t(20,"div",15),r(21),n()(),t(22,"div",13)(23,"div",14),r(24,"Total de cargas"),n(),t(25,"div",15),r(26),n()()(),h(27,Se,4,0,"div",16)(28,Ee,5,1,"div",17)(29,Fe,24,1,"div",18)(30,ze,3,0,"div",19),n()()),s&2&&(a(21),g(i.currentUsername||"-"),a(5),g(i.totalUploads),a(),c("ngIf",i.loading),a(),c("ngIf",i.errorMessage&&!i.loading),a(),c("ngIf",!i.loading&&i.logs.length>0),a(),c("ngIf",!i.loading&&i.logs.length===0))},dependencies:[T,E,L,I,A],styles:[".log-page[_ngcontent-%COMP%]{padding:2rem;max-width:1400px;margin:0 auto}.log-card[_ngcontent-%COMP%]{background:#fff;border-radius:8px;padding:2rem;box-shadow:0 2px 8px #0000001a}.log-card-header[_ngcontent-%COMP%]{margin-bottom:2rem;display:flex;justify-content:space-between;align-items:flex-start;gap:1rem}.header-left[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:1rem;flex:1}.header-icon[_ngcontent-%COMP%]{width:48px;height:48px;display:flex;align-items:center;justify-content:center;border-radius:8px;background-color:#e3f2fd;color:#4a90e2;flex-shrink:0}.header-text[_ngcontent-%COMP%]{flex:1}.header-text[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:2rem;font-weight:600;color:#1a1a1a;margin:0 0 .5rem}.header-text[_ngcontent-%COMP%]   .muted[_ngcontent-%COMP%]{color:#666;font-size:1rem;margin:0}.header-actions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{padding:.75rem 1.5rem;border:none;border-radius:6px;font-size:1rem;font-weight:500;cursor:pointer;transition:all .2s;background-color:#f5f5f5;color:#333}.header-actions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:hover{background-color:#e5e5e5}.log-summary[_ngcontent-%COMP%]{display:flex;gap:1rem;margin-bottom:2rem;flex-wrap:wrap}.summary-item[_ngcontent-%COMP%]{background-color:#f8f9fa;padding:1rem 1.5rem;border-radius:8px;border:1px solid #e9ecef;flex:1;min-width:200px}.summary-item[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-size:.875rem;color:#666;margin-bottom:.5rem;font-weight:500}.summary-item[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600;color:#1a1a1a;margin:0}.loading[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;padding:2rem;justify-content:center}.spinner[_ngcontent-%COMP%]{width:32px;height:32px;border:3px solid #f3f3f3;border-top:3px solid #4a90e2;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.loading-text[_ngcontent-%COMP%]{color:#666;font-size:1rem;font-weight:500}.alert[_ngcontent-%COMP%]{padding:1rem;border-radius:6px;margin-bottom:1rem;display:flex;align-items:center;gap:.75rem}.alert-danger[_ngcontent-%COMP%]{background-color:#fee;color:#c00;border:1px solid #fcc}.table-wrapper[_ngcontent-%COMP%]{overflow-x:auto;border-radius:8px;border:1px solid #e9ecef}.log-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.log-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]{background-color:#f8f9fa}.log-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:1rem;text-align:left;font-weight:600;color:#333;border-bottom:2px solid #dee2e6;white-space:nowrap;font-size:.95rem}.log-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{transition:background-color .2s}.log-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#f8f9fa}.log-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:not(:last-child){border-bottom:1px solid #e9ecef}.log-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:1rem;color:#333;vertical-align:middle}.cell-file[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.file-icon[_ngcontent-%COMP%]{color:#4a90e2;display:flex;align-items:center}.file-name[_ngcontent-%COMP%]{font-weight:500}.status-badge[_ngcontent-%COMP%]{display:inline-block;padding:.25rem .75rem;border-radius:12px;font-size:.875rem;font-weight:500;white-space:nowrap}.status-success[_ngcontent-%COMP%]{background-color:#d4edda;color:#155724}.status-error[_ngcontent-%COMP%]{background-color:#f8d7da;color:#721c24}.status-pending[_ngcontent-%COMP%]{background-color:#fff3cd;color:#856404}.count[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;min-width:32px;padding:.25rem .5rem;background-color:#e3f2fd;color:#1565c0;border-radius:12px;font-weight:600;font-size:.875rem}.count.error[_ngcontent-%COMP%]{background-color:#f8d7da;color:#721c24}.cell-message[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{color:#333;max-width:300px;display:block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.cell-message[_ngcontent-%COMP%]   .muted[_ngcontent-%COMP%]{color:#999}.empty[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:4rem 2rem;text-align:center;color:#666}.empty[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1.125rem;margin:0}@media (max-width: 768px){.log-page[_ngcontent-%COMP%]{padding:1rem}.log-card[_ngcontent-%COMP%]{padding:1.5rem}.log-card-header[_ngcontent-%COMP%]{flex-direction:column}.header-left[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.log-summary[_ngcontent-%COMP%]{flex-direction:column}.summary-item[_ngcontent-%COMP%]{min-width:100%}}"]})}}return o})();var He=(o,d)=>({"status-success":o,"status-error":d});function Ve(o,d){if(o&1&&(t(0,"option",18),r(1),n()),o&2){let e=d.$implicit;c("value",e.value),a(),k(" ",e.label," ")}}function Le(o,d){o&1&&(t(0,"span"),r(1,"Consultar Historial"),n())}function Ae(o,d){o&1&&(t(0,"span"),r(1,"Consultando..."),n())}function Be(o,d){if(o&1&&(t(0,"div",19),u(),t(1,"svg",20),p(2,"circle",21)(3,"path",22)(4,"circle",23),n(),v(),t(5,"span"),r(6),n()()),o&2){let e=f();a(6),g(e.error)}}function Ue(o,d){if(o&1&&(t(0,"tr")(1,"td"),r(2),n(),t(3,"td"),r(4),X(5,"date"),n(),t(6,"td"),r(7),n(),t(8,"td"),r(9),n(),t(10,"td"),r(11),n(),t(12,"td")(13,"span",30),r(14),n()()()),o&2){let e=d.$implicit;a(2),g(e.log_id),a(2),g(Y(5,7,e.timestamp,"dd/MM/yyyy HH:mm:ss")),a(3),g(e.version_politica),a(2),g(e.ip_address||"N/A"),a(2),g(e.user_agent||"N/A"),a(2),c("ngClass",V(10,He,e.accepted,!e.accepted)),a(),k(" ",e.accepted?"Aceptado":"Rechazado"," ")}}function je(o,d){if(o&1&&(t(0,"div",24)(1,"div",25)(2,"h2"),r(3,"Resultados"),n(),t(4,"span",26),r(5),n()(),t(6,"div",27)(7,"table",28)(8,"thead")(9,"tr")(10,"th"),r(11,"Log ID"),n(),t(12,"th"),r(13,"Fecha/Hora"),n(),t(14,"th"),r(15,"Versi\xF3n Pol\xEDtica"),n(),t(16,"th"),r(17,"IP Address"),n(),t(18,"th"),r(19,"User Agent"),n(),t(20,"th"),r(21,"Estado"),n()()(),t(22,"tbody"),h(23,Ue,15,13,"tr",29),n()()()()),o&2){let e=f();a(5),k("",e.historial.length," registro(s) encontrado(s)"),a(18),c("ngForOf",e.historial)}}function Ne(o,d){o&1&&(t(0,"div",31),u(),t(1,"svg",32),p(2,"path",33)(3,"path",34),n(),v(),t(4,"h3"),r(5,"Consulta el historial"),n(),t(6,"p"),r(7,"Selecciona el tipo de documento e ingresa el n\xFAmero para consultar el historial de pol\xEDticas de aceptaci\xF3n"),n()())}var ge=(()=>{class o{constructor(e){this.http=e,this.tipoDocumento="DNI",this.numeroDocumento="",this.historial=[],this.loading=!1,this.error="",this.tiposDocumento=[{value:"DNI",label:"DNI"},{value:"CE",label:"CE"}]}consultarHistorial(){if(!this.numeroDocumento.trim()){this.error="Por favor ingrese un n\xFAmero de documento";return}this.loading=!0,this.error="",this.historial=[];let e=localStorage.getItem("token"),s=new P({Authorization:`Bearer ${e}`}),i=`${O.apiUrl}/politicas/historial/${this.tipoDocumento}/${this.numeroDocumento}`;this.http.get(i,{headers:s}).subscribe({next:l=>{this.loading=!1,l&&l.historial&&Array.isArray(l.historial)?(this.historial=l.historial,this.historial.length===0&&(this.error="No se encontraron registros en el historial")):l&&Array.isArray(l)?this.historial=l:l&&l.data&&Array.isArray(l.data)?this.historial=l.data:(this.historial=[],this.error="No se encontraron registros en el historial")},error:l=>{this.loading=!1,console.error("Error al consultar historial:",l),this.error=l.error?.message||"Error al consultar el historial. Por favor intente nuevamente."}})}limpiar(){this.numeroDocumento="",this.tipoDocumento="DNI",this.historial=[],this.error=""}formatDate(e){return new Date(e).toLocaleString("es-PE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})}static{this.\u0275fac=function(s){return new(s||o)(w(D))}}static{this.\u0275cmp=y({type:o,selectors:[["app-politicas-historial"]],standalone:!0,features:[S],decls:28,vars:12,consts:[[1,"politicas-historial-container"],[1,"page-header"],[1,"subtitle"],[1,"search-section"],[1,"search-card"],[1,"form-group"],["for","tipoDocumento"],["id","tipoDocumento",1,"form-control",3,"ngModelChange","ngModel","disabled"],[3,"value",4,"ngFor","ngForOf"],["for","numeroDocumento"],["type","text","id","numeroDocumento","placeholder","Ingrese el n\xFAmero de documento",1,"form-control",3,"ngModelChange","keyup.enter","ngModel","disabled"],[1,"button-group"],[1,"btn","btn-primary",3,"click","disabled"],[4,"ngIf"],[1,"btn","btn-secondary",3,"click","disabled"],["class","alert alert-error",4,"ngIf"],["class","results-section",4,"ngIf"],["class","empty-state",4,"ngIf"],[3,"value"],[1,"alert","alert-error"],["width","20","height","20","viewBox","0 0 24 24","fill","none","xmlns","http://www.w3.org/2000/svg"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","2"],["d","M12 8v4","stroke","currentColor","stroke-width","2","stroke-linecap","round"],["cx","12","cy","16","r","1","fill","currentColor"],[1,"results-section"],[1,"results-header"],[1,"results-count"],[1,"table-container"],[1,"results-table"],[4,"ngFor","ngForOf"],[1,"status-badge",3,"ngClass"],[1,"empty-state"],["width","64","height","64","viewBox","0 0 24 24","fill","none","xmlns","http://www.w3.org/2000/svg"],["d","M9 11l3 3L22 4","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["d","M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"]],template:function(s,i){s&1&&(t(0,"div",0)(1,"div",1)(2,"h1"),r(3,"Log de Pol\xEDticas de Aceptaci\xF3n"),n(),t(4,"p",2),r(5,"Consulta el historial de pol\xEDticas de aceptaci\xF3n por documento"),n()(),t(6,"div",3)(7,"div",4)(8,"h2"),r(9,"Consultar Historial"),n(),t(10,"div",5)(11,"label",6),r(12,"Tipo de Documento"),n(),t(13,"select",7),R("ngModelChange",function(m){return N(i.tipoDocumento,m)||(i.tipoDocumento=m),m}),h(14,Ve,2,2,"option",8),n()(),t(15,"div",5)(16,"label",9),r(17,"N\xFAmero de Documento"),n(),t(18,"input",10),R("ngModelChange",function(m){return N(i.numeroDocumento,m)||(i.numeroDocumento=m),m}),x("keyup.enter",function(){return i.consultarHistorial()}),n()(),t(19,"div",11)(20,"button",12),x("click",function(){return i.consultarHistorial()}),h(21,Le,2,0,"span",13)(22,Ae,2,0,"span",13),n(),t(23,"button",14),x("click",function(){return i.limpiar()}),r(24," Limpiar "),n()(),h(25,Be,7,1,"div",15),n()(),h(26,je,24,2,"div",16)(27,Ne,8,0,"div",17),n()),s&2&&(a(13),j("ngModel",i.tipoDocumento),c("disabled",i.loading),a(),c("ngForOf",i.tiposDocumento),a(4),j("ngModel",i.numeroDocumento),c("disabled",i.loading),a(2),c("disabled",i.loading||!i.numeroDocumento.trim()),a(),c("ngIf",!i.loading),a(),c("ngIf",i.loading),a(),c("disabled",i.loading),a(2),c("ngIf",i.error),a(),c("ngIf",i.historial.length>0),a(),c("ngIf",!i.loading&&i.historial.length===0&&!i.error))},dependencies:[T,E,L,I,Z,le,re,ae,te,ie,ne,oe],styles:[".politicas-historial-container[_ngcontent-%COMP%]{padding:2rem;max-width:1400px;margin:0 auto}.page-header[_ngcontent-%COMP%]{margin-bottom:2rem}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:2rem;font-weight:600;color:#1a1a1a;margin:0 0 .5rem}.page-header[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{color:#666;font-size:1rem;margin:0}.search-section[_ngcontent-%COMP%]{margin-bottom:2rem}.search-card[_ngcontent-%COMP%]{background:#fff;border-radius:8px;padding:2rem;box-shadow:0 2px 8px #0000001a}.search-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600;color:#1a1a1a;margin:0 0 1.5rem}.form-group[_ngcontent-%COMP%]{margin-bottom:1.5rem}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;font-weight:500;color:#333;margin-bottom:.5rem;font-size:.95rem}.form-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{width:100%;padding:.75rem 1rem;border:1px solid #ddd;border-radius:6px;font-size:1rem;transition:all .2s}.form-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]:focus{outline:none;border-color:#4a90e2;box-shadow:0 0 0 3px #4a90e21a}.form-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]:disabled{background-color:#f5f5f5;cursor:not-allowed}.form-group[_ngcontent-%COMP%]   select.form-control[_ngcontent-%COMP%]{cursor:pointer}.button-group[_ngcontent-%COMP%]{display:flex;gap:1rem;margin-top:1.5rem}.btn[_ngcontent-%COMP%]{padding:.75rem 1.5rem;border:none;border-radius:6px;font-size:1rem;font-weight:500;cursor:pointer;transition:all .2s}.btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.btn-primary[_ngcontent-%COMP%]{background-color:#4a90e2;color:#fff}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#3a7bc8}.btn-primary[_ngcontent-%COMP%]:active:not(:disabled){background-color:#2a6bae}.btn-secondary[_ngcontent-%COMP%]{background-color:#f5f5f5;color:#333}.btn-secondary[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#e5e5e5}.alert[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;padding:1rem;border-radius:6px;margin-top:1rem}.alert[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{flex-shrink:0}.alert-error[_ngcontent-%COMP%]{background-color:#fee;color:#c00;border:1px solid #fcc}.results-section[_ngcontent-%COMP%]{background:#fff;border-radius:8px;padding:2rem;box-shadow:0 2px 8px #0000001a}.results-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem}.results-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600;color:#1a1a1a;margin:0}.results-header[_ngcontent-%COMP%]   .results-count[_ngcontent-%COMP%]{color:#666;font-size:.95rem}.table-container[_ngcontent-%COMP%]{overflow-x:auto}.results-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.results-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]{background-color:#f8f9fa}.results-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:1rem;text-align:left;font-weight:600;color:#333;border-bottom:2px solid #dee2e6;white-space:nowrap}.results-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{transition:background-color .2s}.results-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#f8f9fa}.results-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:not(:last-child){border-bottom:1px solid #e9ecef}.results-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:1rem;color:#333}.status-badge[_ngcontent-%COMP%]{display:inline-block;padding:.25rem .75rem;border-radius:12px;font-size:.875rem;font-weight:500}.status-success[_ngcontent-%COMP%]{background-color:#d4edda;color:#155724}.status-error[_ngcontent-%COMP%]{background-color:#f8d7da;color:#721c24}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:4rem 2rem;text-align:center;color:#666}.empty-state[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{margin-bottom:1.5rem;opacity:.3}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;color:#333;margin:0 0 .5rem}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{max-width:400px;margin:0;line-height:1.6}@media (max-width: 768px){.politicas-historial-container[_ngcontent-%COMP%]{padding:1rem}.search-card[_ngcontent-%COMP%]{padding:1.5rem}.button-group[_ngcontent-%COMP%]{flex-direction:column}.button-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{width:100%}.results-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:.5rem}}"]})}}return o})();var ut=[{path:"politicas-historial",component:ge,title:"Log Pol\xEDticas de Aceptaci\xF3n"},{path:"carga-excel",component:de,title:"Carga de Disponibilidad"},{path:"log",component:me,title:"Historial de Cargas"}];export{ut as RETIROS_ROUTES};
